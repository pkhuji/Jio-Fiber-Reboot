/*
Nodejs script to reboot Jio-Fiber router. 
You can run it with Nodejs v16 or above and use cron job for routine reboot.

Example:
node jioFiberReboot.js ip=192.168.29.1 pwd=password t=2 w=5

CLI Options list

ip
ipAddress
   IP address of Jio-Fiber router.

pwd
password
p
   Pasword of admin account of Jio-Fiber router.

user
username
u
   Username of admin account of Jio-Fiber router. (Optional. Default: admin)

url
   URL of router login page. (Optional. Default: http://${ip}/platform.cgi )

tries
t
   Maximum tries. (Optional. Default: 1)

wait
w
   Wait (in seconds) between tries. (Optional. Default: 1 second)

timeout  
tout  
   Request timout in seconds. (Optional. Default: 60)


*/

var me=Object.create;var V=Object.defineProperty;var ye=Object.getOwnPropertyDescriptor;var he=Object.getOwnPropertyNames;var Se=Object.getPrototypeOf,Oe=Object.prototype.hasOwnProperty;var Ce=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of he(t))!Oe.call(e,r)&&r!==n&&V(e,r,{get:()=>t[r],enumerable:!(i=ye(t,r))||i.enumerable});return e};var k=(e,t,n)=>(n=e!=null?me(Se(e)):{},Ce(t||!e||!e.__esModule?V(n,"default",{value:e,enumerable:!0}):n,e));function te(e,t,n=!0){(!c(e)||!c(t))&&u(["c79e853f-72b6-49ca-9c11-322b160f2173",e,t]);let i=!1,r=t.length;return r===0||(e=e.trim(),n?i=e.slice(-r)===t:i=e.slice(-r).toLowerCase()===t.toLowerCase(),i)?e:e+t}function ne(e,t,n=!0){(!c(e)||!c(t))&&u(["c79e853f-72b6-49ca-9c11-322b160f2173",e,t]);let i=!1,r=t.length;return r===0||(e=e.trim(),n?i=e.slice(0,r)===t:i=e.slice(0,r).toLowerCase()===t.toLowerCase(),i)?e:t+e}function K(e){return c(e)&&!!e.match(/^[\d]{4}-[\d]{2}-[\d]{2} [\d]{2}:[\d]{2}:[\d]{2}$/)}function W({local:e=!0,timestampMs:t=null,timestampS:n=null,dateTimeArgs:i=[],timeInHMS:r="",isUTC:b=!1,nativeDate:d="",prependZero:o=!0,format:a="y-mm-d h:mins:ss",propPassed:s=""}={}){if(c(a)||u([a,"267ba1a9-6857-5ffb-ad3d-abbabdfd1e8e"]),w(s))if(s==="dateTimeArgs"&&!y(i))u([s,"698ead3f-89c4-5725-bcd7-3341b995e268",i]);else if(s==="timestampMs"&&!v(t))u([s,"c58611c6-b46c-5242-b66e-7e329375fd42",t]);else if(s==="timestampS"&&!v(n*1e3))u([s,"11b7af58-27d6-56fd-973b-e4b35a410a88",n]);else if(s==="timeInHMS"&&!K(r))u([s,"1d164080-6a74-58e8-82db-3dd1af3a6942",r]);else if(s==="nativeDate")try{new Date(d)}catch{u(["1fac154c-71f8-4b4c-b526-d4270b0dd744",s,d])}else["timestampMs","timestampS","dateTimeArgs","timeInHMS","nativeDate"].includes(s)||u(["48ee4db8-2f06-59a9-b9f6-cf794a5a1003",s]);let l,L="";try{t?(t=parseInt(t),l=new Date(t)):n?(n=parseInt(n),l=new Date(n*1e3)):y(i)?(i.length>1&&(i[1]=parseInt(i[1])-1),i=i.map(f=>""+f),b?l=new Date(Date.UTC(...i)):l=new Date(...i)):K(r)?(b&&(r+="Z"),l=new Date(r)):d?l=new Date(d):l=new Date}catch(f){u(["05b09945-5040-51c4-97fc-b041d60d5a6e",f])}if(a.includes("y")){let f=e?l.getFullYear():l.getUTCFullYear();f=f.toString(),a=a.split("y").join(f)}if(a.includes("mm")){let f=e?l.getMonth()+1:l.getUTCMonth()+1;f=f.toString(),o&&f.length===1&&(f="0"+f),a=a.split("mm").join(f)}if(a.includes("d")){let f=e?l.getDate():l.getUTCDate();f=f.toString(),o&&f.length===1&&(f="0"+f),a=a.split("d").join(f)}if(a.includes("h")){let f=e?l.getHours():l.getUTCHours();(a.includes("ap")||a.includes("AP"))&&(L=f>=12?"pm":"am",f=f%12,f=f||12),f=f.toString(),o&&f.length===1&&(f="0"+f),a=a.split("h").join(f)}if(a.includes("mins")){let f=e?l.getMinutes():l.getUTCMinutes();f=f.toString(),o&&f.length===1&&(f="0"+f),a=a.split("mins").join(f)}if(a.includes("ss")){let f=e?l.getSeconds():l.getUTCSeconds();f=f.toString(),o&&f.length===1&&(f="0"+f),a=a.split("ss").join(f)}return a.includes("ap")&&(a=a.split("ap").join(L)),a.includes("AP")&&(a=a.split("AP").join(L.toUpperCase())),a}function A(e){return typeof e=="object"&&e!==null}function m(e){return Array.isArray(e)}function y(e){return m(e)&&e.length>0}function h(e,{checkInteger:t=!0,parse:n=!1,negative:i=!1}={}){return n&&c(e)&&(e=e.trim(),e.match(/^-?\d+(\.\d+)?$/)&&(e=parseFloat(e))),typeof e=="number"&&!isNaN(e)?!i&&e<0?!1:t?!!Number.isInteger(e):!0:!1}function J(e,{parse:t=!1,negative:n=!1}={}){return t&&c(e)&&(e=e.trim(),e.match(/^-?\d+(\.\d+)?$/)&&(e=parseFloat(e))),typeof e=="number"&&!isNaN(e)?!(!n&&e<0):!1}function ie(e,t,n=!0){c(t)&&(t=[t]),(!c(e)||!p(t))&&u([e,t,"ae472ff3-f587-59de-aea5-205250606455"]),t=_e(t,"d");let i=t.findIndex(r=>n?e.startsWith(r):$e(e,r));return i===-1?e:e.slice(t[i].length)}function Q(e){return e<0&&(e=.001),new Promise(t=>{setTimeout(t,Math.round(e*1e3))})}function fe(e,t){return e.findIndex(n=>(t=c(t)?t.toLowerCase():t,n=c(n)?n.toLowerCase():n,t===n))}function Fe(e,t){return e.toLowerCase().indexOf(t.toLowerCase())}function $e(e,t){return e.toLowerCase().startsWith(t.toLowerCase())}function R(e,t){return Fe(e,t)!==-1}function z(e,t){return fe(e,t)!==-1}function Y(e,t){return m(e)||u(["10d97e53-455f-44cb-80e4-0f23e36786d0",e]),t?e.filter((n,i,r)=>fe(r,n)===i):e.filter((n,i,r)=>r.indexOf(n)===i)}function c(e){return typeof e=="string"||e instanceof String}function w(e){return c(e)&&e.length>0}function Le(e,t){return(!(w(t)||J(t))||!A(e))&&u(["01231b1a-77fc-41fa-ac08-a5bab19e6c0f",t,e]),Object.hasOwn(e,t)}function _e(e,t="a",n=!1){return(!m(e)||!w(t))&&u(["f3bcd368-e4db-4417-93e5-77c865f31e20",e,t]),t=t.toLowerCase(),n&&(e=G(e)),e.sort((i,r)=>{let b=h(i==null?void 0:i.length)?i.length:0,d=h(r==null?void 0:r.length)?r.length:0;return t==="a"?b-d:d-b})}function ee(e){return e&&(e==null?void 0:e.stack)||e instanceof Error}function xe(e){return c(e)&&e.match(/[\w]{8}-[\w]{4}-[\w]{4}-[\w]{4}-[\w]{12}/)}function u(e,...t){let n=new Error,i=new Date().toLocaleString();if(n.time=i,y(t)&&(e=Ne(e,t)),m(e)){n.message=n.errCode=e.find(d=>xe(d))||e.find(d=>c(d))||"";let r=[...e.filter(d=>!ee(d))];n.topInfo=[...r];let b=function(d){let o=d.find(a=>ee(a));o&&(r.push("--",o),m(o.topInfo)&&(r=[...r,...o.topInfo],b(o.info)))};b(e),e=r}else(c(e)||J(e))&&(n.message=n.errCode=e);throw n.info=e,n}function p(e,{emptyStringAllowed:t=!0}={}){return m(e)&&e.every(n=>c(n)&&!t&&n.length===0?!1:c(n))}function re(e,t,n=!0){return(!c(e)||!c(t))&&u([e,t,"75aed006-652c-5412-bcb8-d735046c1a52"]),e=ne(e,t,n),e=te(e,t,n),e}function v(e){if(!h(e,{checkInteger:!1,parse:!0}))return!1;e=parseInt(e);let t=new Date("1971").getTime(),n=new Date(""+(new Date().getUTCFullYear()+100)).getTime();return e>t&&e<n}function G(e,t){if(!A(e))return e;if(w(t)&&(t=[t]),y(t)){p(t)||u(["aac95e2a-e2be-498e-bee5-711fa0493005",t]);let n={};for(let i in e)t.includes(i)||Le(e,i)&&(n[i]=e[i]);e=n}try{return JSON.parse(JSON.stringify(e))}catch(n){u(["746a0a52-37d8-5477-b4b6-10ed37d36332",n])}}function ae(e,t,n=!0){return c(t)&&(t=[t]),(!c(e)||!m(t))&&u(["d17ff8b7-5bb9-4983-ae9b-a1c5fc3e42c1",e,t]),t.findIndex(i=>n?e.includes(i):R(e,i))!==-1}function ce(e,t,n=!0){return c(t)&&(t=[t]),(!c(e)||!m(t))&&u(["a2f13891-5a48-58b6-b0a7-9ef012dcc0f2",e,t]),t.every(i=>n?e.includes(i):R(e,i))}function Ne(...e){return[].concat(...e)}function se(e,t="*"){return c(e)?e.split("").map(()=>t).join(""):e}var ue=k(require("http"),1),le=k(require("https"),1);var D=require("os"),x=require("child_process"),de=require("util");var M=require("url"),$=require("querystring");var Ae=(0,de.promisify)(x.exec),pe=process.platform==="win32";function De(){return pe}var lt=!De()&&Ie("rsync",{args:"--help",cmdInQuotes:!1,sync:!0,outputIncludes:"Copyright"});function Z(e=[],t=!1,n=1){if(m(e)||(e=[e]),e.length===1&&c(e[0])&&!e[0].includes(D.EOL))console.log(W()+" "+e[0]);else{console.log("-- "+W());for(let i of e)c(i)&&i.length<1||console.log(i);console.log("--")}t&&process.exit(n)}async function X(e,t,{timeoutS:n=60,headers:i={},rejectUnauthorized:r=!1}={}){(!w(e)||!A(i)||!h(n))&&u(["1e7f9925-530d-4c76-9f08-bac736d94c63",e,i,n]),n=n*1e3,i=G(i);let b=Y(Object.keys(i),!0);z(b,"Content-Type")||(i["Content-Type"]="application/json");let d=Y(Object.values(i),!0);A(t)?z(d,"application/json")?t=JSON.stringify(t):t=(0,$.stringify)(t):t=t+"",z(b,"Content-Length")||(i["Content-Length"]=t.length);let{protocol:o,hostname:a,pathname:s,port:l}=new M.URL(e),L=ue.default;o.includes("https")&&(L=le.default);let f={data:"",status:null,headers:null,statusMessage:"",statusCode:null};return await new Promise((we,q)=>{let _=L.request({rejectUnauthorized:r,hostname:a,port:l||80,path:s,method:"POST",headers:i,timeout:n},g=>{f.headers=g.headers,f.status=g.statusCode,f.statusCode=g.statusCode,f.statusMessage=g.statusMessage,g.on("data",P=>{f.data+=P}),g.on("end",()=>{we(f)}),g.on("error",P=>{g.destroy(),q(P)})});_.on("error",g=>{_.destroy(),q(g)}),_.on("timeout",g=>{_.destroy(),q(g)}),_.write(t),_.end()}),f}function Ie(e,{args:t,outputIncludes:n,matchCase:i=!1,matchAll:r=!0,cmdInQuotes:b=!0,sync:d=!1}={}){let o="";c(t)&&(t=[t]),c(n)&&(n=[n]),(!w(e)||!p(t,{emptyStringAllowed:!1})||!p(n,{emptyStringAllowed:!1}))&&u(["20c6703e-072b-4955-b827-3937bb7c6436",e,t,n]),b&&(e=re(e,'"')),t.unshift(e);let a=function(s){if(y(n)){if(!w(s==null?void 0:s.stdout))return!1;if(s=s.stdout,r){if(!ce(s,n,i))return!1}else if(!ae(s,n,i))return!1}return!0};if(d){try{o=(0,x.execSync)(t.join(" "))}catch{return!1}return a(o)}return(async()=>{try{o=await Ae(t.join(" "))}catch{return!1}return a(o)})()}function oe(e){let t=process.argv.slice(2);if(e)return t;let n={};for(let i of t){i=ie(i,["--","-"]),i=i.split("=");let r=i.shift(),b=!0;y(i)&&(b=i.join("=")),n[r]=b}return n}var{ip:F,ipAddress:Ee,pwd:E,password:ze,p:Me,user:N,username:Ue,u:Be,url:I,tries:S,t:He,wait:O,w:je,timeout:C,tout:qe}=oe();E=E||ze||Me;F=F||Ee;N=N||Ue||Be;S=S||He;O=O||je;C=C||qe;w(N)||(N="admin");(!w(F)||!c(E))&&u(["90ca0991-d497-490d-9f25-d15b31da4df2",F,E,"IP or Password not given!"]);w(I)||(I=`http://${F}/platform.cgi`);S=parseInt(S);O=parseInt(O);(!h(S)||S<1)&&(S=1);(!h(O)||O<1)&&(O=1);(!h(C)||C<1)&&(C=60);var T={"Content-Type":"application/x-www-form-urlencoded",Referer:`http://${F}/`},U={thispage:"index.html","users.username":N,"users.password":E,"button.login.users.dashboard":"Login"},be={"Content-Type":"application/x-www-form-urlencoded",Referer:`http://${F}/`},B={thispage:"factoryDefault.html",token:"","button.reboot.statusPage":"Reboot"},ge=0,H=!1,Pe,j;(async()=>{for(;!H&&!(ge>=S);){if(ge++,!Pe)try{j=await X(I,U,{headers:T,timeoutS:C})}catch{continue}let{data:e}=j,t=e.match(/name=\"token\"\s*value=\"(\w+)/);if(!(!y(t)||!y(j.headers["set-cookie"]))){B.token=t[1],be.Cookie=j.headers["set-cookie"][0];try{e=(await X(I,B,{headers:be,timeoutS:C})).data}catch{continue}H=/Router will be up in/.test(e),H||await Q(O)}}if(H)Z(["Jio Router restarted successfully!"]);else{let e=["Error restarting Jio Router!",`Tries: ${S}`,`Timeout: ${C} seconds`,`Wait between tries: ${O} seconds.`,`Ip: ${F}. Username: ${N}`,`URL: ${I}`];e.push("","Token Request Headers:");for(let t in T)e.push(`${t}: ${T[t]}`);e.push("","Token Request Payload:");for(let t in U)t==="users.password"?e.push(`${t}: ${se(U[t])}`):e.push(`${t}: ${U[t]}`);e.push("","Reboot Request Headers:");for(let t in B)e.push(`${t}: ${B[t]}`);Z(e)}console.log(D.EOL)})();
